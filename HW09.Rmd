---
title: "Homework 09 - STAT440"
author: "Joseph Sepich (jps6444)"
date: "11/08/2020"
output:
  pdf_document:
    number_sections: no
---

```{r}
set.seed(42)
```

```{r include=FALSE}
library(dplyr)
library(MASS)
df <- anorexia
```

# Problem 1

```{r}
df$Weight_Increase <- df$Postwt - df$Prewt
```

## Part a

```{r}
qqnorm(df$Weight_Increase)
qqline(df$Weight_Increase)
#qqplot(y, rt(300, df = 5))
```

The results follow the diagonal line (theoretical quantile match) fairly closely, but the tail to the left is steeper than the tail on the right compared to the normal, since the data points lie under the normal line of quantiles.

## Part b

```{r}
# CBT
df %>%
    filter(Treat == 'CBT') %>%
    .$Weight_Increase %>%
    qqnorm()
df %>%
    filter(Treat == 'CBT') %>%
    .$Weight_Increase %>%
    qqline()

# Cont
df %>%
    filter(Treat == 'Cont') %>%
    .$Weight_Increase %>%
    qqnorm()
df %>%
    filter(Treat == 'Cont') %>%
    .$Weight_Increase %>%
    qqline()

# FT
df %>%
    filter(Treat == 'FT') %>%
    .$Weight_Increase %>%
    qqnorm()
df %>%
    filter(Treat == 'FT') %>%
    .$Weight_Increase %>%
    qqline()
```

Each of the three groups roughly follow a gaussian distribution. Actually a lot of the middle quantiles match up for the CBT group, which is promising and this trend of having the middle quantiles match up also happens with the other two treatment groups, so we likely can approximate the distribution using a gaussian distribution.

# Problem 2

## Part a

The conjugate prior to the liklihood for the normal distribution is the normal distribution. Our posterior is then also a normal distribution.

## Part b

The mean of the prior is essentially our initial assumption about where the mean is for the true distribution. I will therefore set the prior parameter $\mu_0 = 0$ which would operate under the assumption that the average weight increase after treatment is zero. This would essentially say we expect there to be no weight increase after treatment. Using this as our prior parameter can help us to see how much our evidence shows of an actual weight increase by looking at the posterior parameter we receive from the evidence. (We do not need to decide on a prior varaince since we are operating on the assumption that our sample variance is the fixed know variance.)

## Part c

\[\sigma^2_0 \rightarrow (\frac{n}{\sigma^2} + \frac{1}{\sigma_0^2})^{-1}\]
\[\mu_0 \rightarrow (\frac{n}{\sigma^2} + \frac{1}{\sigma_0^2})^{-1}(\frac{n\overline{X}}{\sigma^2} + \frac{\mu_0}{\sigma_0^2})\]

```{r}
update_sigma <- function(x, prior_sig, sig=1) {
    (length(x) / sig^2 + 1 / prior_sig^2) ^ -1
}

update_mu <- function(x, prior_mu, prior_sig, sig=1) {
    update_sigma(prior_sig, sig) * (length(x) * mean(x) / sig^2 + prior_mu / prior_sig^2)
}
```

```{r}
df_cbt <- df %>%
    filter(Treat == 'CBT')
df_cont <- df %>%
    filter(Treat == 'Cont')
df_ft <- df %>%
    filter(Treat == 'FT')

prior_sigma_cbt <- sd(df_cbt$Weight_Increase)
prior_mu_cbt <- 0
prior_sigma_cont <- sd(df_cont$Weight_Increase)
prior_mu_cont <- 0
prior_sigma_ft <- sd(df_ft$Weight_Increase)
prior_mu_ft <- 0
```

```{r}
print(paste0('Prior CBT: ', prior_sigma_cbt, ' ', prior_mu_cbt))
print(paste0('Prior Cont: ', prior_sigma_cont, ' ', prior_mu_cont))
print(paste0('Prior FT: ', prior_sigma_ft, ' ', prior_mu_ft))
```

```{r}
post_sigma_cbt <- update_sigma(df_cbt$Weight_Increase, prior_sigma_cbt, prior_sigma_cbt)
post_mu_cbt <- update_mu(df_cbt$Weight_Increase, prior_mu_cbt, prior_sigma_cbt, prior_sigma_cbt)
post_sigma_cont <- update_sigma(df_cont$Weight_Increase, prior_sigma_cont, prior_sigma_cont)
post_mu_cont <- update_mu(df_cont$Weight_Increase, prior_mu_cont, prior_sigma_cont, prior_sigma_cont)
post_sigma_ft <- update_sigma(df_ft$Weight_Increase, prior_sigma_ft, prior_sigma_ft)
post_mu_ft <- update_mu(df_ft$Weight_Increase, prior_mu_ft, prior_sigma_ft, prior_sigma_ft)
```

```{r}
print(paste0('Posterior CBT: ', post_sigma_cbt, ' ', post_mu_cbt))
print(paste0('Posterior Cont: ', post_sigma_cont, ' ', post_mu_cont))
print(paste0('Posterior FT: ', post_sigma_ft, ' ', post_mu_ft))
```

## Part d

```{r}
min_x <- min(df_cbt$Weight_Increase)
max_x <- max(df_cbt$Weight_Increase)
hist(df_cbt$Weight_Increase, freq=F)
curve(dnorm(x,mean=prior_mu_cbt,sd=prior_sigma_cbt), min_x, max_x, add=T, col='black')
abline(v=prior_mu_cbt,col='black')
curve(dnorm(x,mean=post_mu_cbt,sd=post_sigma_cbt), min_x, max_x, add=T, col='blue')
abline(v=post_mu_cbt,col='blue')
```

```{r}
min_x <- min(df_cont$Weight_Increase)
max_x <- max(df_cont$Weight_Increase)
hist(df_cont$Weight_Increase, freq=F)
curve(dnorm(x,mean=prior_mu_cont,sd=prior_sigma_cont), min_x, max_x, add=T, col='black')
abline(v=prior_mu_cont,col='black')
curve(dnorm(x,mean=post_mu_cont,sd=post_sigma_cont), min_x, max_x, add=T, col='blue')
abline(v=post_mu_cont,col='blue')
```

```{r}
min_x <- min(df_ft$Weight_Increase)
max_x <- max(df_ft$Weight_Increase)
hist(df_ft$Weight_Increase, freq=F)
curve(dnorm(x,mean=prior_mu_ft,sd=prior_sigma_ft), min_x, max_x, add=T, col='black')
abline(v=prior_mu_ft,col='black')
curve(dnorm(x,mean=post_mu_ft,sd=post_sigma_ft), min_x, max_x, add=T, col='blue')
abline(v=post_mu_ft,col='blue')
```

The above charts have the actual data plotted a histogram, the black curve is the prior distribution, and the posterior distribution is the blue curve. We can see that in each of the three plots the posterior mean moved from zero toward the mean of the data points, or evidence, we have in our data set. It is also important to note that the variance of the posterior distribution also decreased for each plot. This decrease indicates more confidence in our posterior estimate of $\mu$, since the posterior has more evidence behind it than the prior. Along the same line of thinking the group with the most data point had the smallest posterior variance.

## Part e

```{r}
M <- 1000
c_val <- 0.05

samples_cbt <- rnorm(M, post_mu_cbt, post_sigma_cbt)
samples_cont <- rnorm(M, post_mu_cont, post_sigma_cont)
samples_ft <- rnorm(M, post_mu_ft, post_sigma_ft)

prob_vec <- c(c_val, 1-c_val)
ci_cbt <- quantile(samples_cbt, probs=prob_vec)
ci_cont <- quantile(samples_cont, probs=prob_vec)
ci_ft <- quantile(samples_ft, probs=prob_vec)
```

```{r}
print(paste0('CBT Cred Int: ', ci_cbt))
print(paste0('Cont Cred Int: ', ci_cont))
print(paste0('FT Cred Int: ', ci_ft))
```

According to this analysis our evidence is not credible enough to determine that any of the treatments had an effect that raised (or lowered) weight in the anorexic patients.

# Problem 3

# Problem 4

